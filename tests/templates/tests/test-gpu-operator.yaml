apiVersion: v1
kind: Pod
metadata:
  name: {{ .Chart.Name }}-gpu-operator
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: cuda-vector-add
      image: nvcr.io/nvidia/k8s/cuda-sample:vectoradd-cuda11.7.1-ubuntu20.04
      resources:
        limits:
          nvidia.com/gpu: 1
      command:
        - /bin/bash
        - -c
        - |
          # Run the CUDA sample
          /cuda-samples/vectorAdd
        
          # Check if the test passed
          if [ $? -eq 0 ]; then
            echo "GPU Test PASSED"
          
          else
            echo "GPU Test FAILED"
            exit 1
          fi
  restartPolicy: Never
  nodeSelector: {{ .Values.nodeSelector }}
  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule
